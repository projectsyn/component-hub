<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Integrating Alertmanager with OpsGenie :: Commodore Hub</title>
    <link rel="canonical" href="https://hub.syn.tools/openshift4-monitoring/how-tos/opsgenie.html">
    <link rel="prev" href="../references/prom.html">
    <link rel="next" href="migrate/v0.1-v1.x.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-54393406-10"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','UA-54393406-10')</script>
    <script>var uiRootPath = '../../_'</script>
    <script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/7105834.js"></script>
<link rel="apple-touch-icon" sizes="180x180" href="/_/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/_/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/_/img/favicon-16x16.png">
<link rel="mask-icon" href="/_/img/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <div class="syn_logo"></div>
        <a href="https://hub.syn.tools">Commodore Hub
          </a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Tools</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://syn.tools/commodore/">Commodore</a>
            <a class="navbar-item" href="https://hub.syn.tools/" target="_blank" >Commodore Components Hub</a>
            <a class="navbar-item" href="https://syn.tools/lieutenant-api/">Lieutenant API</a>
            <a class="navbar-item" href="https://syn.tools/lieutenant-operator/">Lieutenant Operator</a>
            <a class="navbar-item" href="https://syn.tools/steward/">Steward</a>
            <a class="navbar-item" href="https://k8up.io/" target="_blank">K8up</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">
            <div class="vshn-unified-logo"></div>
          </a>
          <div class="navbar-dropdown">
            <a class="navbar-item" target="_blank" href="https://www.vshn.ch/">Main website</a>
            <a class="navbar-item" target="_blank" href="https://handbook.vshn.ch/">Handbook</a>
            <a class="navbar-item" target="_blank" href="https://kb.vshn.ch/">Knowledge Base</a>
            <a class="navbar-item" target="_blank" href="https://products.docs.vshn.ch/">Products</a>
            <a class="navbar-item" target="_blank" href="https://legal.docs.vshn.ch/">Legal</a>
            <a class="navbar-item" target="_blank" href="https://control.docs.vshn.ch/">Portal Help</a>
            <a class="navbar-item" target="_blank" href="https://docs.appuio.ch/">APPUiO Documentation</a>
          </div>
        </div>
        <div class="navbar-item">
          <div class="search-field">
            <input id="search-input" class="search-input" type="search" placeholder="Search">
            <button type="submit" class="search-button">
              <i class="fa fa-search"></i>
            </button>
          </div>
        </div>
        <div class="navbar-item">
          <a class="navbar-item" href="https://github.com/projectsyn/" target="_blank"><i
              class="fa fa-github" style="font-size: 30px;"></i>&nbsp;
            GitHub</a>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="openshift4-monitoring" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">OpenShift4 Monitoring</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../references/parameters.html">Parameters</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../references/alert-patching.html"><code>alert-patching.libsonnet</code> API reference</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../references/prom.html"><code>prom.libsonnet</code> API reference</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">How-Tos</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="opsgenie.html">OpsGenie integration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="migrate/v0.1-v1.x.html">Migration from component version v0.1.0 to v1.x</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Explanation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../explanations/resource_management.html">Resource Management</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Runbooks</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../runbooks/podcapacity.html">Pod Capacity Alert</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../runbooks/resourcerequests.html">Resource Requests Alert</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../runbooks/memorycapacity.html">Memory Capacity Alert</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../runbooks/cpucapacity.html">CPU Capacity Alert</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../runbooks/unusedcapacity.html">Node Capacity Alert</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../runbooks/remotewrite.html">Prometheus RemoteWrite Alert</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../runbooks/tcp-memory-usage.html">NodeTcpMemoryUtilizationTooHigh Alert</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenShift4 Monitoring</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../alerts-exporter/index.html">alerts-exporter</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../alerts-exporter/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../driver-amdgpu/index.html">AMD GPU Driver</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../driver-amdgpu/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../appcat/index.html">appcat</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../appcat/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../appuio-cloud/index.html">appuio-cloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../appuio-cloud/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../appuio-cloud-reporting/index.html">appuio-cloud-reporting</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../appuio-cloud-reporting/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../appuio-reporting/index.html">appuio-reporting</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../appuio-reporting/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../argocd/index.html">Argo CD</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../argocd/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../backup-k8up/index.html">backup-k8up</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../backup-k8up/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cert-exporter/index.html">cert-exporter</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cert-exporter/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cert-manager/index.html">cert-manager</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cert-manager/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cilium/index.html">Cilium</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cilium/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cloud-portal/index.html">cloud-portal</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cloud-portal/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cloudscale-cloud-controller-manager/index.html">cloudscale-cloud-controller-manager</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cloudscale-cloud-controller-manager/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cluster-backup/index.html">Cluster Backup</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cluster-backup/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cm-hetznercloud/index.html">CM Hetznercloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cm-hetznercloud/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cockroach-operator/index.html">CockroachDB Operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cockroach-operator/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hub/index.html">Commodore Hub</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../hub/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../crossplane/index.html">crossplane</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../crossplane/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../csi-hetznercloud/index.html">CSI Hetznercloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../csi-hetznercloud/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../csi-cloudscale/index.html">csi-cloudscale</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../csi-cloudscale/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../emergency-credentials-controller/index.html">emergency-credentials-controller</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../emergency-credentials-controller/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../espejo/index.html">espejo</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../espejo/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../etcd/index.html">etcd</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../etcd/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../eventrouter/index.html">eventrouter</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../eventrouter/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../fluentbit/index.html">fluentbit</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../fluentbit/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../gitlab-runner/main/index.html">gitlab-runner</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../gitlab-runner/main/index.html">main</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../grafana-helm/index.html">grafana-helm</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../grafana-helm/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../home-assistant/index.html">Home Assistant</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../home-assistant/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../keycloak/index.html">keycloak</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../keycloak/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../kubevirt-manager/index.html">KubeVirt Manager</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../kubevirt-manager/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../lieutenant/index.html">Lieutenant</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lieutenant/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../machine-api-provider-cloudscale/index.html">machine-api-provider-cloudscale</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../machine-api-provider-cloudscale/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../namespaces/index.html">Managed Namespaces</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../namespaces/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../metallb/index.html">MetalLB</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../metallb/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../mimir/index.html">mimir</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../mimir/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../minio/index.html">minio</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../minio/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../package-monitoring/index.html">monitoring</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../package-monitoring/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../networkpolicy/index.html">NetworkPolicy</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../networkpolicy/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-nodes/index.html">OpenShift 4 Nodes</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-nodes/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift-upgrade-controller/index.html">openshift-upgrade-controller</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift-upgrade-controller/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-console/index.html">OpenShift4 Console</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-console/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-logging/index.html">OpenShift4 Logging</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-logging/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">OpenShift4 Monitoring</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-scheduling/index.html">OpenShift4 Scheduler</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-scheduling/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-config/index.html">openshift4-config</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-config/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-local-storage/index.html">openshift4-local-storage</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-local-storage/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-operators/index.html">openshift4-operators</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-operators/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-slos/index.html">openshift4-slos</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-slos/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-terraform/index.html">openshift4-terraform</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-terraform/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../podsecuritypolicy/index.html">podsecuritypolicy</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../podsecuritypolicy/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../prometheus/index.html">prometheus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../prometheus/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../rook-ceph/index.html">Rook Ceph</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../rook-ceph/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../steward/index.html">Steward</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../steward/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../storageclass/index.html">StorageClass</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../storageclass/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../thanos/index.html">Thanos</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../thanos/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../topolvm/index.html">topolvm</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../topolvm/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../traefik/index.html">Traefik Proxy</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../traefik/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../vault/index.html">vault</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vault/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../vcluster/index.html">vcluster</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vcluster/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../vertical-pod-autoscaler/index.html">vertical-pod-autoscaler</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vertical-pod-autoscaler/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../hub/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">OpenShift4 Monitoring</a></li>
    <li>How-Tos</li>
    <li><a href="opsgenie.html">OpsGenie integration</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/appuio/component-openshift4-monitoring/edit/master/docs/modules/ROOT/pages/how-tos/opsgenie.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Integrating Alertmanager with OpsGenie</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This how-to assumes that you&#8217;re already using OpsGenie.
It additionally assumes that you&#8217;re familiar with managing schedules and escalations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>For VSHN managed clusters</strong> there is a template in the commodore-defaults repo, so the process can be abbreviated:</p>
</div>
<div class="paragraph">
<p>Ensure the Vault secrets below exist (<code>clusters/kv/&lt;tenant-id&gt;/&lt;cluster-id&gt;/opsgenie/api-key</code> and <code>clusters/kv/&lt;tenant-id&gt;/&lt;cluster-id&gt;/opsgenie/heartbeat-password</code>)</p>
</div>
<div class="paragraph">
<p>Set the Team UUID (usually in the tenant&#8217;s <code>common.yml</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">parameters:
  opsgenie:
    teamID: &lt;team-uuid&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Include the template in the cluster YAML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">parameters:
  openshift4_monitoring:
    alertManagerConfig: ${opsgenie:template}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And that&#8217;s it!</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to setup Alertmanager integration with OpsGenie, you&#8217;ll need sufficient permissions in OpsGenie to setup integrations and heartbeats.
If you&#8217;re using teams in OpsGenie, request role "admin" in your team to be able to follow along.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_the_integrations_in_opsgenie_once_per_team"><a class="anchor" href="#_enabling_the_integrations_in_opsgenie_once_per_team"></a>Enabling the integrations in OpsGenie (once per team)</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Prometheus and REST API integrations can be used to forward alerts from multiple clusters to OpsGenie</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In OpsGenie, navigate to <span class="menuseq"><b class="menu">Teams</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Your Team</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Integrations</b></span> and enable the Prometheus and REST API integrations.
You can use the same integrations to receive alerts from multiple Alertmanagers.
In the REST API integration enable "Read Access" and "Create and Update Access."
The REST API integration is required for heartbeat alerts, such as the "Watchdog" alert.</p>
</div>
<div class="paragraph">
<p>Save the API keys which are generated when enabling the integrations in Vault, we&#8217;ll reference them from the Commodore hierarchy.</p>
</div>
<div class="paragraph">
<p>The snippets in this how-to assume that you&#8217;re using the default Commodore Vault hierarchy, and expect the OpsGenie API keys to be in the following locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prometheus Integration: <code>clusters/kv/&lt;tenant-id&gt;/&lt;cluster-id&gt;/opsgenie/api-key</code></p>
</li>
<li>
<p>REST API Integration: <code>clusters/kv/&lt;tenant-id&gt;/&lt;cluster-id&gt;/opsgenie/heartbeat-password</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_the_cluster_heartbeat_in_opsgenie_for_each_cluster"><a class="anchor" href="#_configuring_the_cluster_heartbeat_in_opsgenie_for_each_cluster"></a>Configuring the cluster heartbeat in OpsGenie (for each cluster)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configure a heartbeat in <span class="menuseq"><b class="menu">Teams</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Your Team</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Heartbeats</b></span> to receive <code>Watchdog</code> alerts from the cluster as heartbeats in OpsGenie.
Create a new heartbeat, the name can be whatever you&#8217;d like.
However, we suggest using the Commodore <code>&lt;cluster-id&gt;</code> of the cluster as the heartbeat name.
Set the heartbeat interval to two minutes.
Optionally, you can add the cluster&#8217;s display name (or any other descriptive name for the cluster) in the heartbeat&#8217;s description field.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_alertmanager_to_send_alerts_to_opsgenie"><a class="anchor" href="#_configuring_alertmanager_to_send_alerts_to_opsgenie"></a>Configuring Alertmanager to send alerts to OpsGenie</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To configure Alertmanager to send alerts to OpsGenie we need to configure an Alertmanager receiver using Alertmanager&#8217;s <code>opsgenie</code> integration.
First, we need to configure the <code>opsgenie_api_key</code> in the <code>global</code> section of the Alertmanager config.
For the global API key you&#8217;ll want to reference the Vault secret holding the API key for the Prometheus integration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">openshift4_monitoring:
  alertManagerConfig:
    global:
      opsgenie_api_key: ?{vaultkv:${cluster:tenant}/${cluster:name}/opsgenie/api-key}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we need to configure the OpsGenie receiver.
First off, we want to set our team as the responder for all the alerts received from Alertmanager.
We recommend that you use the team&#8217;s UUID for configuring the responders, as the UUID remains stable even if the team name is changed.
We also configure the OpsGenie receiver as the default receiver.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The team&#8217;s UUID can be found in the URL of the team dashboard.
Alternatively, you can find the Team&#8217;s UUID by querying the OpsGenie API using the <code>curl</code> command below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">OPSGENIE_REST_API_KEY="&lt;Rest API Integration Key&gt;"
TEAM_NAME="Your Team"
curl -H "Authorization: GenieKey $OPSGENIE_REST_API_KEY" "https://api.opsgenie.com/v2/teams/${TEAM_NAME}?identifierType=name" | jq -r '.data.id'</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">openshift4_monitoring:
  alertManagerConfig:
    receivers:
      - name: opsgenie
        opsgenie_configs:
          - responders:
              - id: &lt;team-uuid&gt;
                type: team
    route:
      receiver: opsgenie</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, we configure a number of things to make use of Project Syn and Openshift4 conventions in the alerts which are created in OpsGenie.</p>
</div>
<div class="paragraph">
<p>This how-to makes use of some Project Syn and OpenShift 4 conventions in the alerts, such as the alert criticality being present as label <code>severity</code>.
To ensure the configuration snippets which use fields in <code>.GroupLabels</code> work correctly,  alerts must be grouped by <code>alertname</code>, <code>namespace</code>, and <code>severity</code> at least.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We don&#8217;t need group alerts by the <code>tenant_id</code> and <code>cluster_id</code> labels, since each cluster has its own Alertmanager.
All alerts in a cluster&#8217;s Alertmanager will have the same value for <code>tenant_id</code> and <code>cluster_id</code>, allowing us to refer to them through <code>.CommonLabels</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">openshift4_monitoring:
  alertManagerConfig:
    route:
      group_by:
        - alertname
        - namespace
        - severity</code></pre>
</div>
</div>
<div class="paragraph">
<p>First we want to map the alert group&#8217;s <code>severity</code> label to an OpsGenie priority.
OpsGenie priorities are <code>P1</code>, <code>P2</code>, <code>P3</code> and <code>P4</code> in descending order of urgency.
We want to map <code>critical</code> severity to <code>P1</code>, <code>warning</code> to <code>P2</code>, <code>info</code> to <code>P3</code> and everything else (this includes alerts which don&#8217;t have a severity label) to <code>P4</code>.
To achieve this mapping we add the following configuration in the OpsGenie receiver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">openshift4_monitoring:
  alertManagerConfig:
    receivers:
      - name: opsgenie
        opsgenie_configs:
          - priority: '{{ if eq .GroupLabels.severity "critical" }}P1{{ else if eq .GroupLabels.severity "warning" }}P2{{ else if eq .GroupLabels.severity "info" }}P3{{ else }}P4{{ end }}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we want to have a title for the OpsGenie alerts which gives some Project Syn information at a glance (tenant and cluster):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">openshift4_monitoring:
  alertManagerConfig:
    receivers:
      - name: opsgenie
        opsgenie_configs:
          - message: '[{{ .CommonLabels.tenant_id }}/{{ .CommonLabels.cluster_id }}] {{ .GroupLabels.alertname }} in {{ .GroupLabels.namespace }}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the <a href="https://github.com/prometheus/alertmanager/blob/master/template/default.tmpl">default Alertmanager template</a> for OpsGenie alert descriptions doesn&#8217;t fully match our use case, we deploy a custom template for the alert description.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">openshift4_monitoring:
  alertManagerConfig:
    receivers:
      - name: opsgenie
        opsgenie_configs:
          - description: |-
              {{ if gt (len .Alerts.Firing) 0 -}}
              Alerts Firing:
              {{ range .Alerts.Firing }}
               - Message: {{ .Annotations.message }}
                 Labels:
              {{ range .Labels.SortedPairs }}   - {{ .Name }} = {{ .Value }}
              {{ end }}   Annotations:
              {{ range .Annotations.SortedPairs }}   - {{ .Name }} = {{ .Value }}
              {{ end }}   Source: {{ .GeneratorURL }}
              {{ end }}
              {{- end }}
              {{ if gt (len .Alerts.Resolved) 0 -}}
              Alerts Resolved:
              {{ range .Alerts.Resolved }}
               - Message: {{ .Annotations.message }}
                 Labels:
              {{ range .Labels.SortedPairs }}   - {{ .Name }} = {{ .Value }}
              {{ end }}   Annotations:
              {{ range .Annotations.SortedPairs }}   - {{ .Name }} = {{ .Value }}
              {{ end }}   Source: {{ .GeneratorURL }}
              {{ end }}
              {{- end }}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make alerts filterable, we add a number of key-value pairs as <code>details</code> and a number of values as <code>tags</code>.
OpsGenie allows filtering alerts both by <code>tag</code> and by <code>details.key</code> and <code>details.value</code>.
Note that tags must be provided as a single comma-separated string to Alertmanager.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Alertmanager upstream has merged a <a href="https://github.com/prometheus/alertmanager/pull/2276">PR (prometheus/alertmanager#2276)</a> which will automatically add all common labels as details to the OpsGenie alert.
As of 2021–02–24, there&#8217;s no Alertmanager release which contains this change.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">openshift4_monitoring:
  alertManagerConfig:
    receivers:
      - name: opsgenie
        opsgenie_configs:
          - details:
              namespace: '{{- if .CommonLabels.exported_namespace -}}{{- .CommonLabels.exported_namespace -}}{{- else if .CommonLabels.namespace -}}{{- .CommonLabels.namespace -}}{{- end -}}'
              pod: '{{- if .CommonLabels.pod -}}{{- .CommonLabels.pod -}}{{- end -}}'
              deployment: '{{- if .CommonLabels.deployment -}}{{- .CommonLabels.deployment -}}{{- end -}}'
              alertname: '{{ .GroupLabels.alertname }}'
              cluster_id: '{{ .CommonLabels.cluster_id }}'
              tenant_id: '{{ .CommonLabels.tenant_id }}'
              severity: '{{ .GroupLabels.severity }}'
            tags: '{{ .CommonLabels.tenant_id }},
              {{ .CommonLabels.cluster_id }},
              {{ .GroupLabels.severity }},
              {{ .GroupLabels.alertname }},
              {{ .GroupLabels.namespace }},
              {{- if .CommonLabels.exported_namespace -}}{{ .CommonLabels.exported_namespace }},{{- end -}}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we need to make sure that the Watchdog alert is sent to OpsGenie as a heartbeat instead of a regular alert.
To this effect, we configure an additional receiver which sends alerts to the OpsGenie REST API integration.
In particular, this receiver sends alerts to the heartbeat <code>ping</code> endpoint for the heartbeat we&#8217;ve configured.
If you followed our suggestion and used the Commodore <code>cluster-id</code> as the name for the heartbeat the snippet below will work out of the box.
For this receiver you need to provide the API key of the REST API integration, which should be stored in Vault.</p>
</div>
<div class="paragraph">
<p>In addition to the receiver, we also add a routing configuration to match alerts which are called <code>Watchdog</code> and ensure they&#8217;re sent to the <code>heartbeat</code> receiver with a repeat interval of one minute (60 seconds).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">openshift4_monitoring:
  alertManagerConfig:
    receivers:
      - name: heartbeat
        webhook_configs:
          - send_resolved: false
            url: https://api.opsgenie.com/v2/heartbeats/${cluster:name}/ping
            http_config:
              basic_auth:
                password: ?{vaultkv:${cluster:tenant}/${cluster:name}/opsgenie/heartbeat-password}
    route:
      routes:
        - match:
            alertname: Watchdog
          repeat_interval: 60s
          receiver: heartbeat</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_full_component_configuration"><a class="anchor" href="#_full_component_configuration"></a>Full component configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since we&#8217;ve discussed individual elements of the Alertmanager configuration in the previous section, here&#8217;s the full, copy-pasteable configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">parameters:
  openshift4_monitoring:
    alertManagerConfig:
      global:
        opsgenie_api_key: ?{vaultkv:${cluster:tenant}/${cluster:name}/opsgenie/api-key}
      receivers:
        - name: opsgenie
          opsgenie_configs:
            - priority: '{{ if eq .GroupLabels.severity "critical" }}P1{{ else if eq .GroupLabels.severity "warning" }}P2{{ else if eq .GroupLabels.severity "info" }}P3{{ else }}P4{{ end }}'
              message: '[{{ .CommonLabels.tenant_id }}/{{ .CommonLabels.cluster_id }}] {{ .GroupLabels.alertname }} in {{ .GroupLabels.namespace }}'
              description: |-
                {{ if gt (len .Alerts.Firing) 0 -}}
                Alerts Firing:
                {{ range .Alerts.Firing }}
                 - Message: {{ .Annotations.message }}
                   Labels:
                {{ range .Labels.SortedPairs }}   - {{ .Name }} = {{ .Value }}
                {{ end }}   Annotations:
                {{ range .Annotations.SortedPairs }}   - {{ .Name }} = {{ .Value }}
                {{ end }}   Source: {{ .GeneratorURL }}
                {{ end }}
                {{- end }}
                {{ if gt (len .Alerts.Resolved) 0 -}}
                Alerts Resolved:
                {{ range .Alerts.Resolved }}
                 - Message: {{ .Annotations.message }}
                   Labels:
                {{ range .Labels.SortedPairs }}   - {{ .Name }} = {{ .Value }}
                {{ end }}   Annotations:
                {{ range .Annotations.SortedPairs }}   - {{ .Name }} = {{ .Value }}
                {{ end }}   Source: {{ .GeneratorURL }}
                {{ end }}
                {{- end }}
              details:
                namespace: '{{- if .CommonLabels.exported_namespace -}}{{- .CommonLabels.exported_namespace -}}{{- else if .CommonLabels.namespace -}}{{- .CommonLabels.namespace -}}{{- end -}}'
                pod: '{{- if .CommonLabels.pod -}}{{- .CommonLabels.pod -}}{{- end -}}'
                deployment: '{{- if .CommonLabels.deployment -}}{{- .CommonLabels.deployment -}}{{- end -}}'
                alertname: '{{ .GroupLabels.alertname }}'
                cluster_id: '{{ .CommonLabels.cluster_id }}'
                tenant_id: '{{ .CommonLabels.tenant_id }}'
                severity: '{{ .GroupLabels.severity }}'
              tags: '{{ .CommonLabels.tenant_id }},
                {{ .CommonLabels.cluster_id }},
                {{ .GroupLabels.severity }},
                {{ .GroupLabels.alertname }},
                {{ .GroupLabels.namespace }},
                {{- if .CommonLabels.exported_namespace -}}{{ .CommonLabels.exported_namespace }},{{- end -}}'
              responders:
                - id: &lt;team-uuid&gt;
                  type: team
        - name: heartbeat
          webhook_configs:
            - send_resolved: false
              url: https://api.opsgenie.com/v2/heartbeats/${cluster:name}/ping
              http_config:
                basic_auth:
                  password: ?{vaultkv:${cluster:tenant}/${cluster:name}/opsgenie/heartbeat-password}
      route:
        group_by:
          - alertname
          - namespace
          - severity
        receiver: opsgenie
        routes:
          - match:
              alertname: Watchdog
            repeat_interval: 60s
            receiver: heartbeat</code></pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../references/prom.html"><code>prom.libsonnet</code> API reference</a></span>
  <span class="next"><a href="migrate/v0.1-v1.x.html">Migration from component version v0.1.0 to v1.x</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright © VSHN 2021 – All Rights Reserved. <a href="https://vshn.ch/en/privacy-policy/">Privacy Policy</a>, <a href="https://vshn.ch/en/imprint/">Imprint</a>, and <a href="https://vshn.ch/en/contact/">Contact</a>.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/vendor/search.js" id="search-script" data-base-path="../.." data-page-path="/openshift4-monitoring/how-tos/opsgenie.html"></script>
<script async src="../../_/../search-index.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
  </body>
</html>
