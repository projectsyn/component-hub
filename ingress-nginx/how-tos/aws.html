<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Commodore Components Hub</title>
    <link rel="canonical" href="https://hub.syn.tools/ingress-nginx/how-tos/aws.html">
    <link rel="prev" href="../index.html">
    <link rel="next" href="logformat.html">
    <meta name="generator" content="Antora 2.3.3">
    <link rel="stylesheet" href="../../_/css/site.css">

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/7105834.js"></script>
<meta name="apple-mobile-web-app-capable" content="yes" />
<link rel="apple-touch-icon" sizes="152x152" href="/_/img/favicon-152x152.png">
<link rel="apple-touch-icon" sizes="167x167" href="/_/img/favicon-167x167.png">
<link rel="apple-touch-icon" sizes="180x180" href="/_/img/favicon-180x180.png">

<link rel="icon" type="image/png" href="/_/img/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="/_/img/favicon-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/_/img/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/_/img/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/_/img/favicon-32x32.png" sizes="32x32">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a class="navbar-item" href="https://hub.syn.tools"><span class="syn_logo"></span></a>
        <a class="navbar-item" href="https://hub.syn.tools">Commodore Components Hub</a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Tools</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://docs.syn.tools/commodore/">Commodore</a>
            <a class="navbar-item" target="_blank" href="https://github.com/topics/commodore-component">Commodore Components</a>
            <a class="navbar-item" href="https://k8up.io/" target="_blank">K8up</a>
            <a class="navbar-item" href="https://docs.syn.tools/lieutenant-api/">Lieutenant API</a>
            <a class="navbar-item" href="https://docs.syn.tools/lieutenant-operator/">Lieutenant Operator</a>
            <a class="navbar-item" href="https://docs.syn.tools/steward/">Steward</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">
            <div class="vshn_logo"></div>
          </a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://vshn.ch/en/" target="_blank">VSHN</a>
            <a class="navbar-item" href="https://appuio.ch/" target="_blank">APPUiO</a>
            <a class="navbar-item" href="https://twitter.com/vshn_ch" target="_blank"><i
                class="fa fa-twitter"></i>&nbsp; Twitter</a>
            <a class="navbar-item" href="https://kb.vshn.ch/" target="_blank">Knowledge Base</a>
          </div>
        </div>
        <div class="navbar-item">
          <input id="search-input" type="text" placeholder="Search">
        </div>
        <div class="navbar-item">
          <a class="navbar-item" href="https://github.com/projectsyn/" target="_blank"><i class="fa fa-github"></i>&nbsp;
            GitHub</a>
        </div>
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="ingress-nginx" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">ingress-nginx</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="aws.html">AWS - Amazon Web Services Load Balancers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="logformat.html">NGINX upstream log format as JSON</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../references/parameters.html">Parameters</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">ingress-nginx</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">adhoc-configurations</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../adhoc-configurations/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Argo CD</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../argocd/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">backup-k8up</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../backup-k8up/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">cert-manager</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cert-manager/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">cluster-backup</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cluster-backup/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Commodore Components Hub</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../hub/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">coredns</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../coredns/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Crossplane</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../crossplane/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">csi-cloudscale</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../csi-cloudscale/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">eks-addon-manager</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../eks-addon-manager/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Espejo</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../espejo/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">eventrouter</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../eventrouter/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">fluentbit</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../fluentbit/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">fortune</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../fortune/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">grafana-helm</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../grafana-helm/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">ingress-nginx</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">keycloak</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../keycloak/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Kubernetes Metrics Server</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../metrics-server/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">machineset-egress-cidr-operator</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../machineset-egress-cidr-operator/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">metallb</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../metallb/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">minio</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../minio/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">NetworkPolicy</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../networkpolicy/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">nfs-client-provisioner</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../nfs-client-provisioner/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">nfs-subdir-external-provisioner</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../nfs-subdir-external-provisioner/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">OpenShift 4 Authentication</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-authentication/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">OpenShift 4 Machine Management</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-nodes/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">OpenShift 4 Registry</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-registry/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">OpenShift 4 Version</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-version/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">openshift-prometheus-proxy</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift-prometheus-proxy/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">OpenShift4 Console</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-console/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">OpenShift4 Logging</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-logging/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">OpenShift4 Monitoring</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-monitoring/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">OpenShift4 Scheduler</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-scheduling/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">openshift4-ingress</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-ingress/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">prom-label-proxy</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../prom-label-proxy/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">prometheus-pushgateway</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../prometheus-pushgateway/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">rancher-monitoring</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../rancher-monitoring/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Resource Locker Operator</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../resource-locker/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">secret-generator</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../secret-generator/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">signalilo</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../signalilo/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Steward</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../steward/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">StorageClass</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../storageclass/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">system-upgrade-controller</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../system-upgrade-controller/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Terraform OpenShift4 cloudscale.ch</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-cloudscale/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Thanos</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../thanos/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">traefik</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../traefik/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">vault-secrets-operator</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vault-secrets-operator/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../hub/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">ingress-nginx</a></li>
    <li><a href="aws.html">AWS - Amazon Web Services Load Balancers</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/projectsyn/component-ingress-nginx/edit/master/docs/modules/ROOT/pages/how-tos/aws.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="_aws_amazon_web_services_load_balancers"><a class="anchor" href="#_aws_amazon_web_services_load_balancers"></a>AWS - Amazon Web Services Load Balancers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are several possibilities to setup external access into the EKS cluster on AWS.
AWS provides three load balancer types.
[ELB Elastic Load Balancing - Version 1](<a href="https://docs.aws.amazon.com/elasticloadbalancing/index.html" class="bare">docs.aws.amazon.com/elasticloadbalancing/index.html</a>), also known as classic load balancer, is outdated and should not be used for new deployments.
The version 2 types [NLB - Network Load Balancer](<a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/network/introduction.html" class="bare">docs.aws.amazon.com/elasticloadbalancing/latest/network/introduction.html</a>) and [ALB - Application Load Balancer](<a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html" class="bare">docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html</a>) are usually used.</p>
</div>
<div class="paragraph">
<p>The ALB is able to interact with the traffic on layer 7.
This allows several additional features like log the traffic or integrate a AWS WAF.
NLB provides a failure tollerant network package forwarding on layer 4.</p>
</div>
<div class="sect2">
<h3 id="_nlb_network_load_balancer"><a class="anchor" href="#_nlb_network_load_balancer"></a>NLB - Network Load Balancer</h3>
<div class="paragraph">
<p>Kubernetes provides the ability to create the NLB directly out of the cluster by defining a service object of type LoadBalancer with the special annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">parameters:
  ingress_nginx:
    helm_values:
      service:
        annotations:
          service.beta.kubernetes.io/aws-load-balancer-type: 'nlb'
        externalTrafficPolicy: Local</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_alb_application_load_balancer"><a class="anchor" href="#_alb_application_load_balancer"></a>ALB - Application Load Balancer</h3>
<div class="paragraph">
<p>While it is technially possible to create the ALB out of the cluster, deploying the ALB with a different method like Terraform, gives full access to all capabilities an ALB can provide.
In the case the ALB is not created out of the cluster, we just configure the nodePorts for HTTP and HTTPs passing the traffic to the NGINX Ingress Controllers.</p>
</div>
<div class="paragraph">
<p>Using <code>externalTrafficPolicy: Local</code> ensures that only NGINX Ingress Controller pods on the same node are used.
If a ingress pod on a specific node doesn&#8217;t answer, the ALB health check will detect this and will take out this path.
On the other hand this prevents an additional hop to an ingress pod on a different node, which would lower the throughput.
Check the blog [A Deep Dive into Kubernetes External Traffic Policies](<a href="https://www.asykim.com/blog/deep-dive-into-kubernetes-external-traffic-policies" class="bare">www.asykim.com/blog/deep-dive-into-kubernetes-external-traffic-policies</a>) for more details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">parameters:
  ingress_nginx:
    helm_values:
        service:
          type: NodePort
          externalTrafficPolicy: Local
          nodePorts:
            http: 32080
            https: 32443</code></pre>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../index.html">Home</a></span>
  <span class="next"><a href="logformat.html">NGINX upstream log format as JSON</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright © VSHN 2020 – All Rights Reserved. <a href="https://vshn.ch/en/privacy-policy/">Privacy Policy</a>, <a href="https://vshn.ch/en/imprint/">Imprint</a>, and <a href="https://vshn.ch/en/contact/">Contact</a>.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
  </body>
</html>
