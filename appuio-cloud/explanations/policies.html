<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Cloud Agent Policies :: Commodore Hub</title>
    <link rel="canonical" href="https://hub.syn.tools/appuio-cloud/explanations/policies.html">
    <link rel="prev" href="../references/parameters.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-54393406-10"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','UA-54393406-10')</script>
    <script>var uiRootPath = '../../_'</script>
    <script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/7105834.js"></script>
<link rel="apple-touch-icon" sizes="180x180" href="/_/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/_/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/_/img/favicon-16x16.png">
<link rel="mask-icon" href="/_/img/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <div class="syn_logo"></div>
        <a href="https://hub.syn.tools">Commodore Hub
          </a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Tools</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://syn.tools/commodore/">Commodore</a>
            <a class="navbar-item" href="https://hub.syn.tools/" target="_blank" >Commodore Components Hub</a>
            <a class="navbar-item" href="https://syn.tools/lieutenant-api/">Lieutenant API</a>
            <a class="navbar-item" href="https://syn.tools/lieutenant-operator/">Lieutenant Operator</a>
            <a class="navbar-item" href="https://syn.tools/steward/">Steward</a>
            <a class="navbar-item" href="https://k8up.io/" target="_blank">K8up</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">
            <div class="vshn-unified-logo"></div>
          </a>
          <div class="navbar-dropdown">
            <a class="navbar-item" target="_blank" href="https://www.vshn.ch/">Main website</a>
            <a class="navbar-item" target="_blank" href="https://handbook.vshn.ch/">Handbook</a>
            <a class="navbar-item" target="_blank" href="https://kb.vshn.ch/">Knowledge Base</a>
            <a class="navbar-item" target="_blank" href="https://products.docs.vshn.ch/">Products</a>
            <a class="navbar-item" target="_blank" href="https://legal.docs.vshn.ch/">Legal</a>
            <a class="navbar-item" target="_blank" href="https://control.docs.vshn.ch/">Portal Help</a>
            <a class="navbar-item" target="_blank" href="https://docs.appuio.ch/">APPUiO Documentation</a>
          </div>
        </div>
        <div class="navbar-item">
          <div class="search-field">
            <input id="search-input" class="search-input" type="search" placeholder="Search">
            <button type="submit" class="search-button">
              <i class="fa fa-search"></i>
            </button>
          </div>
        </div>
        <div class="navbar-item">
          <a class="navbar-item" href="https://github.com/projectsyn/" target="_blank"><i
              class="fa fa-github" style="font-size: 30px;"></i>&nbsp;
            GitHub</a>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="appuio-cloud" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">appuio-cloud</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">How-Tos</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../how-tos/tls.html">Setup Webook Certificate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../how-tos/connect-to-control-api.html">Connect Zone to Control-API</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">References</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../references/parameters.html">Parameters</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Explanations</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="policies.html">Policies</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">appuio-cloud</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../acme-dns/index.html">acme-dns</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../acme-dns/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../adhoc-configurations/index.html">adhoc-configurations</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../adhoc-configurations/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../airlock-microgateway-operator/index.html">airlock-microgateway-operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../airlock-microgateway-operator/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../alerts-exporter/index.html">alerts-exporter</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../alerts-exporter/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../driver-amdgpu/index.html">AMD GPU Driver</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../driver-amdgpu/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../appcat/index.html">appcat</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../appcat/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../appcat-service-postgresql/index.html">appcat-service-postgresql</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../appcat-service-postgresql/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../control-api/index.html">APPUiO Control API</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../control-api/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">appuio-cloud</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../appuio-cloud-reporting/index.html">appuio-cloud-reporting</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../appuio-cloud-reporting/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../appuio-reporting/index.html">appuio-reporting</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../appuio-reporting/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../argocd/index.html">Argo CD</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../argocd/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../aws-cloudwatch-metrics/index.html">aws-cloudwatch-metrics</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../aws-cloudwatch-metrics/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../aws-load-balancer-controller/index.html">aws-load-balancer-controller</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../aws-load-balancer-controller/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../backup-k8up/index.html">backup-k8up</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../backup-k8up/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../blackbox-exporter/index.html">blackbox-exporter</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../blackbox-exporter/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cert-exporter/index.html">cert-exporter</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cert-exporter/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cert-manager/index.html">cert-manager</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cert-manager/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cilium/index.html">Cilium</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cilium/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cloud-portal/index.html">cloud-portal</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cloud-portal/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cloudscale-cloud-controller-manager/index.html">cloudscale-cloud-controller-manager</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cloudscale-cloud-controller-manager/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cloudscale-loadbalancer-controller/index.html">cloudscale-loadbalancer-controller</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cloudscale-loadbalancer-controller/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cluster-backup/index.html">Cluster Backup</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cluster-backup/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cluster-autoscaler/index.html">cluster-autoscaler</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cluster-autoscaler/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cm-hetznercloud/index.html">CM Hetznercloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cm-hetznercloud/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cockroach-operator/index.html">CockroachDB Operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cockroach-operator/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../hub/index.html">Commodore Hub</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../hub/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-compliance/index.html">Compliance Operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-compliance/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../coredns/index.html">CoreDNS</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../coredns/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../cortex-tenant-ns-label/index.html">cortex-tenant-ns-label</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cortex-tenant-ns-label/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../crossplane/index.html">crossplane</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../crossplane/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../csi-driver-smb/index.html">CSI driver SMB</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../csi-driver-smb/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../csi-exoscale/index.html">CSI Exoscale</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../csi-exoscale/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../csi-hetznercloud/index.html">CSI Hetznercloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../csi-hetznercloud/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../csi-cloudscale/index.html">csi-cloudscale</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../csi-cloudscale/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../emergency-credentials-controller/index.html">emergency-credentials-controller</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../emergency-credentials-controller/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../espejo/index.html">espejo</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../espejo/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../espejote/index.html">Espejote</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../espejote/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../etcd/index.html">etcd</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../etcd/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../eventrouter/index.html">eventrouter</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../eventrouter/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../exoscale-cloud-controller-manager/index.html">exoscale-cloud-controller-manager</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../exoscale-cloud-controller-manager/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../exporter-filterproxy/index.html">exporter-filterproxy</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../exporter-filterproxy/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../external-secrets-operator/index.html">external-secrets-operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../external-secrets-operator/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../fleetlock/index.html">Fleetlock</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../fleetlock/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../floodgate/index.html">floodgate</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../floodgate/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../fluentbit/index.html">fluentbit</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../fluentbit/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../fluentd-forwarder/main/index.html">Fluentd Forwarder</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../fluentd-forwarder/main/index.html">main</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../gitlab-runner/main/index.html">gitlab-runner</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../gitlab-runner/main/index.html">main</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../grafana-helm/index.html">grafana-helm</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../grafana-helm/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../group-sync-operator/index.html">Group Sync Operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../group-sync-operator/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../home-assistant/index.html">Home Assistant</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../home-assistant/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../ingress-nginx/index.html">ingress-nginx</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../ingress-nginx/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../json-exporter/index.html">json-exporter</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../json-exporter/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../keycloak/index.html">keycloak</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../keycloak/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../keycloak-attribute-sync-controller/index.html">Keycloak Attribute Sync Controller</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../keycloak-attribute-sync-controller/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../metrics-server/index.html">Kubernetes Metrics Server</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../metrics-server/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../kubevirt-manager/index.html">KubeVirt Manager</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../kubevirt-manager/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../kubevirt-operator/index.html">KubeVirt Operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../kubevirt-operator/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../kyverno/index.html">kyverno</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../kyverno/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../lieutenant/index.html">Lieutenant</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lieutenant/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../lieutenant-keycloak-idp-controller/index.html">lieutenant-keycloak-idp-controller</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lieutenant-keycloak-idp-controller/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../loki/index.html">loki</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../loki/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../machine-api-provider-cloudscale/index.html">machine-api-provider-cloudscale</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../machine-api-provider-cloudscale/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../machineset-egress-cidr-operator/index.html">machineset-egress-cidr-operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../machineset-egress-cidr-operator/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../namespaces/index.html">Managed Namespaces</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../namespaces/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../managed-manifests/index.html">managed-manifests</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../managed-manifests/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../metallb/index.html">MetalLB</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../metallb/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../mimir/index.html">mimir</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../mimir/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../minio/index.html">minio</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../minio/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../package-monitoring/index.html">monitoring</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../package-monitoring/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../networkpolicy/index.html">NetworkPolicy</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../networkpolicy/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../nextcloud/index.html">Nextcloud</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../nextcloud/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../nfs-subdir-external-provisioner/index.html">nfs-subdir-external-provisioner</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../nfs-subdir-external-provisioner/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../nvidia-gpu-operator/index.html">nvidia-gpu-operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../nvidia-gpu-operator/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openbao/index.html">openbao</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openbao/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-authentication/index.html">OpenShift 4 Authentication</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-authentication/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-ingress/index.html">Openshift 4 Ingress</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-ingress/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-nodes/index.html">OpenShift 4 Nodes</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-nodes/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-registry/index.html">OpenShift 4 Registry</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-registry/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift-upgrade-controller/index.html">openshift-upgrade-controller</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift-upgrade-controller/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-console/index.html">OpenShift4 Console</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-console/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-dns/index.html">Openshift4 DNS</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-dns/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-logging/index.html">OpenShift4 Logging</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-logging/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-monitoring/index.html">OpenShift4 Monitoring</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-monitoring/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-scheduling/index.html">OpenShift4 Scheduler</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-scheduling/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-api/index.html">openshift4-api</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-api/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-config/index.html">openshift4-config</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-config/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-keepalived/index.html">openshift4-keepalived</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-keepalived/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-local-storage/index.html">openshift4-local-storage</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-local-storage/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-operators/index.html">openshift4-operators</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-operators/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-proxy/index.html">openshift4-proxy</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-proxy/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-service-mesh/index.html">openshift4-service-mesh</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-service-mesh/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-slos/index.html">openshift4-slos</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-slos/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-terraform/index.html">openshift4-terraform</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-terraform/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-olm/index.html">Operator Lifecycle Manager</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-olm/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../paralus/index.html">paralus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../paralus/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../podsecuritypolicy/index.html">podsecuritypolicy</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../podsecuritypolicy/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../prom-label-proxy/index.html">prom-label-proxy</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../prom-label-proxy/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../prometheus/index.html">prometheus</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../prometheus/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../prometheus-pushgateway/index.html">Prometheus Pushgateway</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../prometheus-pushgateway/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../rbac/index.html">rbac</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../rbac/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../registry-cache/index.html">registry-cache</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../registry-cache/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../rook-ceph/index.html">Rook Ceph</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../rook-ceph/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../rotating-bucket-backup/index.html">rotating-bucket-backup</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../rotating-bucket-backup/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../openshift4-s3-forwarder/index.html">S3 Forwarder</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../openshift4-s3-forwarder/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../secret-generator/index.html">secret-generator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../secret-generator/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../secrets/index.html">Secrets</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../secrets/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../sigstore-policy-controller/index.html">sigstore-policy-controller</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../sigstore-policy-controller/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../splunk-operator/index.html">Splunk Operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../splunk-operator/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../stackgres-operator/index.html">stackgres-operator</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../stackgres-operator/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../statefulset-resize-controller/index.html">statefulset-resize-controller</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../statefulset-resize-controller/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../steward/index.html">Steward</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../steward/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../storage-local-static/index.html">storage-local-static</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../storage-local-static/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../storageclass/index.html">StorageClass</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../storageclass/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../system-upgrade-controller/index.html">system-upgrade-controller</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../system-upgrade-controller/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../thanos/index.html">Thanos</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../thanos/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../topolvm/index.html">topolvm</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../topolvm/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../traefik/index.html">Traefik Proxy</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../traefik/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../vault/index.html">vault</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vault/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../vcluster/index.html">vcluster</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vcluster/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../vcluster-provisioner/index.html">vCluster Provisioner</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vcluster-provisioner/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../vertical-pod-autoscaler/index.html">vertical-pod-autoscaler</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vertical-pod-autoscaler/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../vshn-sli-reporting/index.html">vshn-sli-reporting</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vshn-sli-reporting/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../xelon-csi/index.html">xelon-csi</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../xelon-csi/index.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../yawol-controller/index.html">yawol-controller</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../yawol-controller/index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../hub/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">appuio-cloud</a></li>
    <li>Explanations</li>
    <li><a href="policies.html">Policies</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/appuio/component-appuio-cloud/edit/master/docs/modules/ROOT/pages/explanations/policies.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Cloud Agent Policies</h1>
<div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
This documentation explains how the different admission webhooks and controllers, referenced here as policies, interact to implement the requirements and architectural decisions for APPUiO Cloud.
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_namespace_ownership"><a class="anchor" href="#_namespace_ownership"></a>Namespace ownership</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The overall desired architecture for namespace ownership on APPUiO Cloud is documented in the <a href="https://kb.vshn.ch/appuio-cloud/references/architecture/namespace-ownership.html">APPUiO Cloud for System Engineers</a> documentation.
This component implements the architecture described there with the <a href="https://github.com/appuio/appuio-cloud-agent">APPUiO Cloud Agent</a>.</p>
</div>
<div class="paragraph">
<p>This article explains how the different policies managed by the component implement namespace ownership and other adjacent policies.</p>
</div>
<div class="paragraph">
<p>Looking at the quality requirements for APPUiO cloud, there are three main points which need to be covered by the implementation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Users should be able to <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/usability/ns-arbitrary-name.html">create arbitrary namespaces directly with <code>kubectl create</code></a>.</p>
</li>
<li>
<p>Users should be able to <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/usability/create-ns-with-oc-new-project.html">create arbitrary namespaces through OpenShift&#8217;s Project mechanism</a>, either on the web console or with <code>oc new-project</code>.</p>
</li>
<li>
<p>Any namespace created by a regular user must be <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/functional/namespace-organization.html">associated with an organization for billing purposes</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, the following APPUiO Cloud requirements also need to be considered in the implementation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A single organization can only <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/performance/ns-quota.html">create a limited number of namespaces</a> on an APPUiO Cloud zone.</p>
</li>
<li>
<p>Users should be able to <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/usability/create-ns-with-serviceaccount.html">use ServiceAccount tokens to create namespaces</a> belonging to the same organization to which the ServiceAccount belongs.</p>
</li>
<li>
<p>Users should be able to modify selected annotations and labels on namespaces belonging to their organizations.
For example, this is required to allow users to <a href="https://docs.appuio.cloud/user/explanation/organizations-and-rbac.html#_transfer_projects">reassign namespaces to a different organization</a>.</p>
</li>
<li>
<p>By default, <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/usability/ns-organization-rbac.html">the namespace&#8217;s organization is granted role <code>admin</code></a> in the namespace.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_request_flow_and_policy_execution"><a class="anchor" href="#_request_flow_and_policy_execution"></a>Request flow and policy execution</h3>
<div class="paragraph">
<p>The diagram shows how the policies interact with a request to create a <code>Namespace</code>, <code>Project</code> or <code>ProjectRequest</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We only show interactions which are relevant to <code>CREATE</code> requests.
Some policies, such as <code>validate-namespace-metadata</code> are also executed on <code>UPDATE</code> requests.</p>
</div>
<div class="paragraph">
<p>See the detailed policy explanations or the policy reference documentation for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock kroki-error">
<div class="content">
<pre>                               /---------------\
                               | cFD0          |
                               | CREATE        |
                               | Namespace,    |
                               | ProjectRequest|
                               |               |
                               \-------+-------/
                                       |
                                       |
                            PRIV       v
                            +---------------------+
                            |  +---------------+  |
                            |  |cBLUVALIDATE   |  |
                            |  +---------------+  |    yes
                            | Principal is allowed+------------------------------------+
                            |  to bypass policies |                                    |
                            | {d}                 |                                    |
                            +----------+----------+                                    |
                                       |                                               |
                                       |no                                             |
                                       |                                               |
                            NMEV       v                                               |
                            +--------------------+                                     |
                            |  +---------------+ |                                     |
                            |  |cBLUVALIDATE   | |                                     |
                            |  +---------------+ |                                     |
                        yes |  Check if requested|                                     |
+---------------------------+  namespace/project |                                     |
|                           |  name matches a    |                                     |
|                           |  reserved prefix   |                                     |
|                           | {d}                |                                     |
|                           +----------+---------+                                     |
|                                      |                                               |
|                                      |no                                             |
|                                      |                                               |
|              +-----------------------+-----------------+                             |
|              |                                         |                             |
|              |CREATE                                   |CREATE                       |
|              |ProjectRequest                           |Namespace                    |
|              |                                         |                             |
|              |                          +--------------+--------------+              |
|    ORG_NS    v                          |                             |              |
|    +-----------------+                  |Principal           Principal|              |
|    |+---------------+|                  |is User                 is SA|              |
|    ||cBLUVALIDATE   ||                  v                             v              |
|    |+---------------+|       +----------------------+     +----------------------+   |
|    |  Check that user| no    :ORG_NS                |     :ORG_NS                |   |
|    |  has default    +----+  | +-----------------+  |     |  +----------------+  |   |
|    |  organization   |    |  | | +-------------+ |  |     |  | +-------------+|  |   |
|    | {d}             |    |  | | |cPNKMUTATE   | |  |     |  | |cPNKMUTATE   ||  |   |
|    +-----------------+    |  | | +-------------+ |  |     |  | +-------------+|  |   |
|            |              |  | |    Inject user's|  |     |  |    Inject SA's |  |   |
|            |yes           |  | |    default      |  |     |  |    organization|  |   |
|            |              |  | |    organization |  |     |  |    if no label |  |   |
|            v              |  | |    if no label  |  |     |  |    in request  |  |   |
|        +--------+         |  | |    in request   |  |     |  | {d}            |  |   |
|        |  c2A2  |         |  | | {d}             |  |     |  +----------------+  |   |
|        |  ALLOW |         |  | +-----------------+  |     |           |          |   |
|        | request|         |  |          |           |     |           v          |   |
|        |        |         |  |          v           |     | +------------------+ |   |
|        +---+----+         |  | +------------------+ |     | |+---------------+ | |   |
|            |              |  | |+---------------+ | |     | ||cBLUVALIDATE   | | |   |
|            |              |  | ||cBLUVALIDATE   | | |     | |+---------------+ | |   |
|            v              |  | |+---------------+ | |     | |    Check that NS | |   |
|   /------------------\    |  | |    Check that NS | |     | |    belongs to    | |   |
|   |      cFD0        |    |  | |    belongs to    | |     | |    organization  | |   |
|   | CREATE Project[1]|    |  | |    organization  | |     | |    and that it   | |   |
|   |                  |    |  | |    and user is   | |     | |    matches SA's  | |   |
|   \--------+---------/    |  | |    member of it  | |     | |    organization  | |   |
|            |              |  | | {d}              | |     | | {d}              | |   |
|            |              |  | +------------------+ |     | +------------------+ |   |
|    PRJ_ORG v              |  |                      |     |                      |   |
|    +---------------+      |  +-------+------+-------+     +-------+------+-------+   |
|    |+-------------+|      |          |      |                     |      |           |
|    ||cPNKMUTATE   ||      |          |      |                     |      |           |
|    |+-------------+|      |          |      |                     |      |           |
|    | Inject        |      |          |      |                     |      |           |
|    | organization  |      |          |      |                     |      |           |
|    | from project  |      |     no   |      |                     |      |           |
|    | annotation    |      +----------|------+---------------------|------+           |
|    | {d}           |      |          |                            |                  |
|    +-------+-------+      |          |                            |                  |
|            |              |          |           yes              |                  |
|            |              |          +------------+---------------+                  |
|            v              |                       |                                  |
|  /--------------------\   |                       |                                  |
|  |  cFD0              |   |                       |                                  |
|  |      triggers      |   |                       |                                  |
|  | CREATE Namespace[2]|   |                       |                                  |
|  |                    |   |              NS_QUOT  v                                  |
|  \---------+----------/   |              +-----------------+                         |
|            |              |              |+---------------+|                         |
|            |              |              ||cBLUVALIDATE   ||                         |
|            |              |              |+---------------+|                         |
|            |              |         no   |  Check if       |                         |
|            |              +--------------+  organization   |                         |
|            |              |              |  can create     |                         |
|            |              |              |  more namespaces|                         |
|            |              |              | {d}             |                         |
|            |              |              +--------+--------+                         |
|            |              |                       |                                  |
|            |              |                       |yes                               |
|            |              |                       |                                  |
|            |              |              NMEV     v                                  |
|            |              |              +-----------------+                         |
|            |              |              |+---------------+|                         |
|            |              |              ||cBLUVALIDATE   ||                         |
|            |              |              |+---------------+|                         |
|            |              |         no   | Check if        |                         |
|            |              +--------------+ the request only|                         |
|            |              |              | contains allowed|                         |
|            |              |              | labels and      |                         |
|            |              |              | annotations     |                         |
|            |              |              |{d}              |                         |
|            |              |              +--------+--------+                         |
|            |              |                       |                                  |
|            |              |                       |yes                               |
|            |              |                       |                                  |
|            |              v                       v                                  |
|            |          +--------+              +--------+                             |
|            |          |  cRED  |              |  c2A2  |                             |
+------------|---------&gt;|  DENY  |              |  ALLOW |&lt;----------------------------+
             |          | request|              | request|
             |          |        |              |        |
             |          +--------+              +---+----+
             |                                      |
             |                                      |
             |                                      v
             |                              /----------------\
             |                              | cFD0           |
             |                              | CREATE         |
             +-----------------------------&gt;| Namespace with |
                                            | organization   |
                                            | label          |
                                            |                |
                                            \-------+--------/
                                                    |
                                                    |
                                     +--------------+--------------+
                                     |                             |
                            ORG_RBAC v                  RES_QUOT   v
                            +-----------------+         +---------------------+
                            |+---------------+|         |  +---------------+  |
                            ||cYELRECONCILE  ||         |  |cYELRECONCILE  |  |
                            |+---------------+|         |  +---------------+  |
                            |    Grant the    |         |   Create            |
                            |    organization |         |   ResourceQuota and |
                            |    Role "admin" |         |   LimitRange objects|
                            |    in the NS    |         |   in the namespace  |
                            |{d}              |         |{d}                  |
                            +-----------------+         +---------------------+</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Project</code> resources can&#8217;t be created directly by users.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>Namespace</code> resources which are created from a <code>ProjectRequest</code> always originate from a privileged system principal which can bypass the namespace restrictions.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Checking whether a principal is allowed to bypass the namespace policies is implemented as exclude rules in the other policies.
However, to better illustrate the flow of a request in the diagram, we pretend it&#8217;s a separate policy (labeled <code>PRIV</code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Mutating policies are executed before validating policies, both are executed in parallel with other policies of the same type.
We organize them in a flow-chart style to better illustrate how they interact.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_policies_which_are_executed_for_all_requests_by_unprivileged_principals"><a class="anchor" href="#_policies_which_are_executed_for_all_requests_by_unprivileged_principals"></a>Policies which are executed for all requests by unprivileged principals</h3>
<div class="paragraph">
<p>The following policies are executed for all namespaces which are created by an unprivileged principal:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://github.com/appuio/appuio-cloud-agent/blob/master/webhooks/namespace_metadata_validator.go"><code>namespace_metadata_validator</code> (labeled <code>NMEV</code>)</a></dt>
<dd>
<p>This policy ensures that users can&#8217;t create namespaces which match a pattern which is reserved for the system.
We need this policy to ensure that users can&#8217;t adversely impact the system by using namespace names which might be used by the system in the future.</p>
<div class="paragraph">
<p>Effectively, this is a restriction of the requirement that <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/usability/ns-arbitrary-name.html">users can choose arbitrary namespace names</a> to ensure overall system availability.
The component allows operators to configure the set of disallowed patterns.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This policy also ensures that users can only create or edit selected labels and annotations.
In particular, we want to allow users to transfer namespace ownership between organizations of which they&#8217;re members.</p>
</div>
<div class="paragraph">
<p>+
As shown in the <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/usability/ns-organization-rbac.html">end-user documentation</a>, transferring a namespace is done by changing the namespace&#8217;s <code>appuio.io/organization</code> label to the organization which should receive ownership of the namespace.</p>
</div>
<div class="paragraph">
<p>+
To protect the cluster, we need to ensure that users can&#8217;t modify arbitrary labels or annotations on a namespaces, since OpenShift exposes a number of privileged operations (such as setting a namespace-wide node selector for workloads) as labels and annotations on namespace objects.</p>
</div>
<div class="paragraph">
<p>+
TIP: This policy is executed when namespaces are created or updated.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://github.com/appuio/appuio-cloud-agent/blob/master/webhooks/namespace_quota_validator.go"><code>namespace_quota_validator.go</code> (labeled <code>NS_QUOT</code>)</a></dt>
<dd>
<p>This policy denies creation of new namespaces for an organization which has used up their namespace quota on a zone.
The component allows operators to adjust the global and per-organization namespace quota.</p>
<div class="paragraph">
<p>This policy implements the requirement that a single organization can only <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/performance/ns-quota.html">create a limited number of namespaces</a> on an APPUiO Cloud zone.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This policy has two modes:
Legacy mode: The policy reads the namespace quota from a ConfigMap in the same namespace as the policy.
UsageProfile mode: See <a href="https://kb.vshn.ch/appuio-cloud/references/architecture/control-api-usage-profile.html">Control API: UsageProfile</a>.
Overrides of the default quotas are still possible using the same ConfigMap as the legacy policy.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><a href="https://github.com/appuio/appuio-cloud-agent/blob/master/controllers/org_rbac_controller.go"><code>org_rbac_controller.go</code> (labeled <code>ORG_RBAC</code>)</a></dt>
<dd>
<p>The <a href="https://github.com/appuio/appuio-cloud-agent/blob/master/controllers/org_rbac_controller.go">Organization RBAC Controller</a> of the APPUiO Cloud Agent makes sure that by default organizations are granted all the permissions necessary to manager their own namespaces.</p>
<div class="paragraph">
<p>It does so by creating <code>RoleBindings</code> in every organization namespace that grant configured <code>ClusterRoles</code>.
Most importantly, it grants role <code>admin</code> to the organization to which the new namespace belongs.</p>
</div>
<div class="paragraph">
<p>The controller will only make sure that the <code>RoleBindings</code> exist and won&#8217;t modify existing <code>RoleBindings</code>.
This allows organizations to further restrict access for their members.</p>
</div>
<div class="paragraph">
<p>This fulfills the requirement that <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/usability/ns-organization-rbac.html">namespaces are owned by organizations</a>.</p>
</div>
</dd>
<dt class="hdlist1"><a href="https://github.com/appuio/appuio-cloud-agent/blob/master/controllers/legacy_resource_quota_controller.go"><code>legacy_resource_quota_controller.go</code> (labeled <code>RES_QUOT</code>)</a></dt>
<dd>
<p>This policy is applied to any namespace which is created with an organization label.
It generates default <code>ResourceQuota</code> and <code>LimitRange</code> objects in all namespaces belonging to an organization.
The policy allows cluster operators to adjust the generated objects by adding appropriate annotations to namespaces.</p>
<div class="paragraph">
<p>This policy implements the requirement that <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/performance/resource-quota.html">the APPUiO Cloud zone is protected from abusive resource usage</a> for resource types which can be managed through Kubernetes <code>ResourceQuota</code> and <code>LimitRange</code> objects.
Notably, we deploy a quota limiting the cumulative memory and CPU <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">resource requests and limits</a> of all containers per namespace and a quota limiting the count of other Resources, such as <code>Service</code> and <code>Secret</code> objects, per namespace.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This policy is superseeded by the UsageProfile feature. See <a href="https://kb.vshn.ch/appuio-cloud/references/architecture/control-api-usage-profile.html">Control API: UsageProfile</a>.</p>
</div>
<div class="paragraph">
<p>Overrides of the default quotas are still possible by adding the same annotations as before to the namespace.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A validating policy (<a href="https://github.com/appuio/appuio-cloud-agent/blob/master/webhooks/reserved_resourcequota_limitrange_validator.go"><code>reserved_resourcequota_limitrange_validator.go</code></a>) forbids modification of the reserved <code>ResourceQuota</code> and <code>LimitRange</code> objects in the namespace.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_policies_which_are_executed_for_requests_to_create_a_namespace_by_specific_unprivileged_principals"><a class="anchor" href="#_policies_which_are_executed_for_requests_to_create_a_namespace_by_specific_unprivileged_principals"></a>Policies which are executed for requests to create a Namespace by specific unprivileged principals</h3>
<div class="paragraph">
<p>We handle actual validation of namespace creation by users and by ServiceAccounts in different policies:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://github.com/appuio/appuio-cloud-agent/blob/master/webhooks/namespace_project_organization_mutator.go"><code>namespace_project_organization_mutator.go</code> (labeled <code>ORG_NS</code>)</a></dt>
<dd>
<p>This policy is executed when a namespace or OpenShift project is created by a user or a ServiceAccount.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_user_flow"><a class="anchor" href="#_user_flow"></a>User flow</h4>
<div class="paragraph">
<p>If the user creates a namespace without an explicit <code>appuio.io/organization</code> label, their default organization is set as the value of the label.</p>
</div>
<div class="paragraph">
<p>+
The policy denies the request if the user tries to create a namespace for an organization which they&#8217;re not a member of.
It also denies the request when a user who doesn&#8217;t have a default organization tries to create a namespace without an explicit organization label.</p>
</div>
<div class="paragraph">
<p>+
This policy implements the requirement that <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/usability/ns-arbitrary-name.html">users can create arbitrary namespaces directly with <code>kubectl create</code></a>
Additionally, this policy ensures that <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/functional/namespace-organization.html">user namespaces are associated with an organization for billing purposes</a> for those namespaces.</p>
</div>
</div>
<div class="sect3">
<h4 id="_serviceaccount_flow"><a class="anchor" href="#_serviceaccount_flow"></a>ServiceAccount flow</h4>
<div class="paragraph">
<p>The policy looks up the ServiceAccount&#8217;s organization by looking up the organization to which the ServiceAccount&#8217;s namespace belongs.
If the ServiceAccount creates a namespace without an explicit <code>appuio.io/organization</code> label, it&#8217;s organization is set as the value of the label.</p>
</div>
<div class="paragraph">
<p>+
The policy denies the request if the ServiceAccount tries to create a namespace for a different organization than the one to which it belongs.</p>
</div>
<div class="paragraph">
<p>+
This policy implements the requirement that users should be able to <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/usability/create-ns-with-serviceaccount.html">use ServiceAccount tokens to create namespaces</a>.
Additionally, this policy ensures that <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/functional/namespace-organization.html">user namespaces are associated with an organization for billing purposes</a> for namespaces created by ServiceAccounts.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_openshift_project_flow"><a class="anchor" href="#_openshift_project_flow"></a>OpenShift Project flow</h3>
<div class="paragraph">
<p>This policy is executed when the control plane creates a <code>Project</code> resource based on a <code>ProjectRequest</code> created by a user.
The policy reads the annotation <code>openshift.io/requester</code> on the <code>Project</code> and uses the value of that annotation to lookup the user which requested the project.
The user&#8217;s default organization is then injected as label <code>appuio.io/organization</code> on the <code>Project</code> resource<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.</p>
</div>
<div class="paragraph">
<p>+
This policy ensures the requirement that <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/functional/namespace-organization.html">user namespaces are associated with an organization for billing purposes</a> for namespaces created through an OpenShift project.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_policies_which_dont_interact_with_organization_namespaces"><a class="anchor" href="#_policies_which_dont_interact_with_organization_namespaces"></a>Policies which don&#8217;t interact with organization namespaces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The component also manages policies which implement other features than namespace ownership on APPUiO Cloud zones.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://github.com/appuio/appuio-cloud-agent/blob/master/webhooks/pod_runonce_active_deadline_seconds_mutator.go"><code>pod_runonce_active_deadline_seconds_mutator.go</code></a></dt>
<dd>
<p>This policy injects a default value for <code>.spec.activeDeadlineSeconds</code> for run-once pods<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> which don&#8217;t have an explicit value for that field.</p>
<div class="paragraph">
<p>This policy implements requirement that <a href="https://kb.vshn.ch/appuio-cloud/references/quality-requirements/performance/resource-quota.html">the APPUiO Cloud zone is protected from abusive resource usage</a> to protect the cluster from run-once pods with unbounded runtime.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The policy which validates mutations of annotations on namespaces allows users to override the default value which is injected for individual namespaces by annotating the namespace.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><a href="https://github.com/appuio/appuio-cloud-agent/blob/master/webhooks/pod_node_selector_mutator.go"><code>pod_node_selector_mutator.go</code></a></dt>
<dd>
<p>This policy injects a default value for <code>.spec.nodeSelector</code> for pods which don&#8217;t have an explicit value for that field.</p>
<div class="paragraph">
<p>This allows users to choose a default node class value for their workloads if they don&#8217;t specify a node selector in their pod or pod controller manifests.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The policy which validates mutations of annotations on namespaces allows users to override the default value which is injected for individual namespaces by annotating the namespace.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><a href="https://github.com/appuio/appuio-cloud-agent/blob/master/webhooks/ratio_validator.go"><code>ratio_validator.go</code></a></dt>
<dd>
<p>This policy validates that the ratio of CPU and memory requests to limits in a pod is within a configured range.</p>
<div class="paragraph">
<p>On violation of the ratio, the policy warns the user that they might be billed more than expected for their workloads.
It does not however deny the request.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Fair-usage ratios differ between cloud providers and node node classes.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>The APPUiO Cloud requirements implemented by the policies can be found in the VSHN Knowledge Base, in the section <a href="https://kb.vshn.ch/appuio-cloud/index.html">APPUiO Cloud for Engineers</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. On OpenShift whenever a <code>Project</code> is created, the control plane automatically creates a <code>Namespace</code> in the background. Labels added on a <code>Project</code> by the policy are applied to the <code>Namespace</code> as well, ensuring that any projects created by a user belong to that user&#8217;s default organization.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. Usually, those are pods created by Kubernetes jobs or cronjobs. However, the policy also affects pods created directly without a controller, for example by applying a Pod manifest to the cluster.
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../references/parameters.html">Parameters</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright  VSHN 2021  All Rights Reserved. <a href="https://vshn.ch/en/privacy-policy/">Privacy Policy</a>, <a href="https://vshn.ch/en/imprint/">Imprint</a>, and <a href="https://vshn.ch/en/contact/">Contact</a>.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/vendor/search.js" id="search-script" data-base-path="../.." data-page-path="/appuio-cloud/explanations/policies.html"></script>
<script async src="../../_/../search-index.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
  </body>
</html>
